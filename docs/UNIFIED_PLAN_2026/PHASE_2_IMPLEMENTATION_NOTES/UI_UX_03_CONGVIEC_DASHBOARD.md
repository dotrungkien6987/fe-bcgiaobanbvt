# Phase 2 UI/UX - C√¥ng Vi·ªác Dashboard

**Part 3 of 5**  
**Screen:** CongViecDashboardPage  
**Type:** New Page  
**Effort:** 8h  
**Status:** ‚ùå Need to Create

---

## üì± Screen Layout (Mobile)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚Üê C√¥ng Vi·ªác                    [+ T·∫°o] [‚ãÆ]    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                ‚îÇ
‚îÇ  üì• VI·ªÜC T√îI NH·∫¨N (12)            [Xem t·∫•t c·∫£ ‚Üí]‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ Ch·ªù  ‚îÇ ‚îÇƒêang  ‚îÇ ‚îÇ Ch·ªù  ‚îÇ ‚îÇHo√†n  ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇnh·∫≠n  ‚îÇ ‚îÇl√†m   ‚îÇ ‚îÇduy·ªát ‚îÇ ‚îÇth√†nh ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  3   ‚îÇ ‚îÇ  7   ‚îÇ ‚îÇ  2   ‚îÇ ‚îÇ 34   ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇT·ª´    ‚îÇ ‚îÇC·∫ßn   ‚îÇ ‚îÇQu√°   ‚îÇ ‚îÇS·∫Øp   ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇch·ªëi  ‚îÇ ‚îÇb·ªï sung‚îÇ ‚îÇh·∫°n   ‚îÇ ‚îÇh·∫°n   ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  1   ‚îÇ ‚îÇ  2   ‚îÇ ‚îÇ  3   ‚îÇ ‚îÇ  5   ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                ‚îÇ
‚îÇ  ‚ö†Ô∏è C·∫¢NH B√ÅO DEADLINE (3)                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ üî¥ CV-001: B√°o c√°o th√°ng...   [Qu√° h·∫°n]  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ üü† CV-015: H·ªçp ph√≤ng ban      [1 ng√†y]   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ üü° CV-023: Review t√†i li·ªáu    [2 ng√†y]   ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                ‚îÇ
‚îÇ  üì§ VI·ªÜC T√îI GIAO (5)             [Xem t·∫•t c·∫£ ‚Üí]‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇCh∆∞a  ‚îÇ ‚îÇƒê√£    ‚îÇ ‚îÇƒêang  ‚îÇ ‚îÇHo√†n  ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇgiao  ‚îÇ ‚îÇgiao  ‚îÇ ‚îÇth·ª±c  ‚îÇ ‚îÇth√†nh ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  1   ‚îÇ ‚îÇ  2   ‚îÇ ‚îÇhi·ªán  ‚îÇ ‚îÇ 15   ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ      ‚îÇ ‚îÇ      ‚îÇ ‚îÇ  3   ‚îÇ ‚îÇ      ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇCh·ªù    ‚îÇ ‚îÇC·∫ßn   ‚îÇ ‚îÇTi·∫øn  ‚îÇ ‚îÇT·ª∑ l·ªá ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇduy·ªát  ‚îÇ ‚îÇki·ªÉm  ‚îÇ ‚îÇƒë·ªô TB ‚îÇ ‚îÇƒë√∫ng  ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  2   ‚îÇ ‚îÇtra   ‚îÇ ‚îÇ 65%  ‚îÇ ‚îÇh·∫°n   ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ      ‚îÇ ‚îÇ  1   ‚îÇ ‚îÇ      ‚îÇ ‚îÇ 80%  ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                ‚îÇ
‚îÇ  üóÇÔ∏è L·ªäCH S·ª¨ & B√ÅO C√ÅO                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ üìä L·ªãch s·ª≠ ho√†n th√†nh        [Xem ‚Üí]     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    Th√°ng n√†y: 34 vi·ªác, TB: 2.3 ng√†y     ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                ‚îÇ
‚îÇ  üõ†Ô∏è C√îNG C·ª§ & XEM KH√ÅC                        ‚îÇ
‚îÇ  [üå≥ C√¢y c√¥ng vi·ªác] [üß† Mind Map] [üìä B√°o c√°o]‚îÇ
‚îÇ                                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üóÇÔ∏è File Structure

### Frontend Files

```
fe-bcgiaobanbvt/src/features/QuanLyCongViec/
‚îú‚îÄ Dashboard/
‚îÇ  ‚îú‚îÄ CongViecDashboardPage.js           [CREATE] ‚ùå
‚îÇ  ‚îî‚îÄ components/
‚îÇ     ‚îú‚îÄ ReceivedSectionDashboard.js     [CREATE] ‚ùå
‚îÇ     ‚îú‚îÄ AssignedSectionDashboard.js     [CREATE] ‚ùå
‚îÇ     ‚îú‚îÄ DeadlineAlertBanner.js          [CREATE] ‚ùå
‚îÇ     ‚îî‚îÄ ToolsMenu.js                    [CREATE] ‚ùå
‚îÇ
‚îú‚îÄ CongViec/
‚îÇ  ‚îî‚îÄ components/
‚îÇ     ‚îî‚îÄ StatusGrid.js                   [REUSE] ‚úÖ
‚îÇ
‚îî‚îÄ components/
   ‚îî‚îÄ SummaryCards/
      ‚îî‚îÄ CongViecSummaryCard.js          [REUSE] ‚úÖ
```

### Backend Files

```
giaobanbv-be/modules/workmanagement/
‚îú‚îÄ controllers/
‚îÇ  ‚îî‚îÄ dashboard.controller.js            [UPDATE] ‚ö†Ô∏è
‚îÇ     ‚îî‚îÄ getCongViecDashboard()          [ADD METHOD]
‚îÇ
‚îî‚îÄ routes/
   ‚îî‚îÄ dashboard.route.js                 [UPDATE] ‚ö†Ô∏è
      ‚îî‚îÄ GET /dashboard/congviec/:nhanVienId
```

---

## üé® Component Breakdown

### 1. CongViecDashboardPage (Main Container)

**File:** `Dashboard/CongViecDashboardPage.js` [CREATE]

**Structure:**

```javascript
import React, { useEffect } from "react";
import { useNavigate } from "react-router-dom";
import { useDispatch, useSelector } from "react-redux";
import {
  Container,
  Stack,
  Box,
  Typography,
  IconButton,
  Button,
  Fab,
} from "@mui/material";
import { Add, More, Refresh } from "iconsax-react";
import useAuth from "hooks/useAuth";
import {
  getCongViecDashboard,
  selectCongViecDashboard,
  selectDashboardLoading,
} from "./dashboardSlice";
import StatusGrid from "../CongViec/components/StatusGrid";
import DeadlineAlertBanner from "./components/DeadlineAlertBanner";
import ToolsMenu from "./components/ToolsMenu";
import LoadingScreen from "components/LoadingScreen";

const CongViecDashboardPage = () => {
  const navigate = useNavigate();
  const dispatch = useDispatch();
  const { user } = useAuth();
  const nhanVienId = user?.NhanVienID;

  const dashboard = useSelector(selectCongViecDashboard);
  const isLoading = useSelector(selectDashboardLoading);

  const [toolsMenuOpen, setToolsMenuOpen] = useState(false);

  // Fetch dashboard data on mount
  useEffect(() => {
    if (nhanVienId) {
      dispatch(getCongViecDashboard(nhanVienId));
    }
  }, [dispatch, nhanVienId]);

  const handleRefresh = () => {
    dispatch(getCongViecDashboard(nhanVienId, { refresh: true }));
  };

  const handleCreateTask = () => {
    navigate("/quanlycongviec/cong-viec/tao-moi");
  };

  if (isLoading && !dashboard) {
    return <LoadingScreen />;
  }

  return (
    <Container maxWidth="lg" sx={{ pb: 10 }}>
      <Stack spacing={3}>
        {/* Header */}
        <Box display="flex" justifyContent="space-between" alignItems="center">
          <Typography variant="h5" fontWeight={600}>
            üìã C√¥ng Vi·ªác
          </Typography>
          <Stack direction="row" spacing={1}>
            <IconButton onClick={handleRefresh} size="small">
              <Refresh />
            </IconButton>
            <Button
              variant="contained"
              startIcon={<Add />}
              onClick={handleCreateTask}
            >
              T·∫°o m·ªõi
            </Button>
          </Stack>
        </Box>

        {/* Deadline Alert Banner */}
        {dashboard?.received?.overdueTasks?.length > 0 && (
          <DeadlineAlertBanner tasks={dashboard.received.overdueTasks} />
        )}

        {/* Received Section */}
        <ReceivedSectionDashboard
          data={dashboard?.received}
          onNavigate={(filter) =>
            navigate(`/quanlycongviec/cong-viec-cua-toi?${filter}`)
          }
        />

        {/* Assigned Section */}
        <AssignedSectionDashboard
          data={dashboard?.assigned}
          onNavigate={(filter) =>
            navigate(`/quanlycongviec/viec-toi-giao?${filter}`)
          }
        />

        {/* History & Reports */}
        <Card>
          <CardContent>
            <Typography variant="h6" gutterBottom>
              üóÇÔ∏è L·ªäCH S·ª¨ & B√ÅO C√ÅO
            </Typography>
            <Button
              fullWidth
              variant="outlined"
              onClick={() => navigate("/quanlycongviec/lich-su-hoan-thanh")}
            >
              üìä L·ªãch s·ª≠ ho√†n th√†nh ‚Üí Xem t·∫•t c·∫£
            </Button>
            <Typography variant="caption" color="text.secondary" mt={1}>
              Th√°ng n√†y: {dashboard?.history?.completedThisMonth || 0} vi·ªác, TB:{" "}
              {dashboard?.history?.avgCompletionTime || 0} ng√†y
            </Typography>
          </CardContent>
        </Card>

        {/* Tools & Other Views */}
        <Card>
          <CardContent>
            <Typography variant="h6" gutterBottom>
              üõ†Ô∏è C√îNG C·ª§ & XEM KH√ÅC
            </Typography>
            <Stack direction="row" spacing={2} flexWrap="wrap">
              <Button
                variant="outlined"
                startIcon={<TreeIcon />}
                onClick={() => navigate("/quanlycongviec/tree-view")}
              >
                C√¢y c√¥ng vi·ªác
              </Button>
              <Button
                variant="outlined"
                startIcon={<MindMapIcon />}
                onClick={() => navigate("/quanlycongviec/mind-map")}
              >
                Mind Map
              </Button>
              <Button
                variant="outlined"
                startIcon={<ChartIcon />}
                onClick={() => navigate("/quanlycongviec/bao-cao")}
              >
                B√°o c√°o
              </Button>
            </Stack>
          </CardContent>
        </Card>
      </Stack>

      {/* FAB for mobile */}
      <Fab
        color="primary"
        sx={{ position: "fixed", bottom: 80, right: 16 }}
        onClick={() => setToolsMenuOpen(true)}
      >
        <More />
      </Fab>

      {/* Tools Menu Drawer */}
      <ToolsMenu open={toolsMenuOpen} onClose={() => setToolsMenuOpen(false)} />
    </Container>
  );
};

export default CongViecDashboardPage;
```

**Estimated Lines:** ~250 lines

---

### 2. ReceivedSectionDashboard Component

**File:** `Dashboard/components/ReceivedSectionDashboard.js` [CREATE]

**Purpose:** Display "Vi·ªác t√¥i nh·∫≠n" with StatusGrid

```javascript
import React from "react";
import { Box, Typography, Button, Card, CardContent } from "@mui/material";
import StatusGrid from "../../CongViec/components/StatusGrid";

const ReceivedSectionDashboard = ({ data, onNavigate }) => {
  const statusConfig = [
    {
      id: "DA_GIAO",
      label: "Ch·ªù nh·∫≠n",
      count: data?.byStatus?.DA_GIAO || 0,
      color: "info",
      icon: "‚è≥",
      onClick: () => onNavigate("status=DA_GIAO"),
    },
    {
      id: "DANG_THUC_HIEN",
      label: "ƒêang l√†m",
      count: data?.byStatus?.DANG_THUC_HIEN || 0,
      color: "primary",
      icon: "‚ö°",
      onClick: () => onNavigate("status=DANG_THUC_HIEN"),
    },
    {
      id: "CHO_DUYET",
      label: "Ch·ªù duy·ªát",
      count: data?.byStatus?.CHO_DUYET || 0,
      color: "warning",
      icon: "‚è∞",
      onClick: () => onNavigate("status=CHO_DUYET"),
    },
    {
      id: "HOAN_THANH",
      label: "Ho√†n th√†nh",
      count: data?.byStatus?.HOAN_THANH || 0,
      color: "success",
      icon: "‚úÖ",
      onClick: () => onNavigate("status=HOAN_THANH"),
    },
    {
      id: "TU_CHOI",
      label: "T·ª´ ch·ªëi",
      count: data?.byStatus?.TU_CHOI || 0,
      color: "error",
      icon: "‚ùå",
      onClick: () => onNavigate("status=TU_CHOI"),
    },
    {
      id: "CAN_BO_SUNG",
      label: "C·∫ßn b·ªï sung",
      count: data?.byStatus?.CAN_BO_SUNG || 0,
      color: "secondary",
      icon: "üìù",
      onClick: () => onNavigate("status=CAN_BO_SUNG"),
    },
    {
      id: "OVERDUE",
      label: "Qu√° h·∫°n",
      count: data?.overdueCount || 0,
      color: "error",
      icon: "üî¥",
      onClick: () => onNavigate("overdue=true"),
    },
    {
      id: "DUE_SOON",
      label: "S·∫Øp h·∫°n",
      count: data?.dueSoonCount || 0,
      color: "warning",
      icon: "üü°",
      onClick: () => onNavigate("dueSoon=true"),
    },
  ];

  return (
    <Card>
      <CardContent>
        <Box
          display="flex"
          justifyContent="space-between"
          alignItems="center"
          mb={2}
        >
          <Typography variant="h6">
            üì• VI·ªÜC T√îI NH·∫¨N ({data?.total || 0})
          </Typography>
          <Button size="small" onClick={() => onNavigate("")}>
            Xem t·∫•t c·∫£ ‚Üí
          </Button>
        </Box>

        <StatusGrid items={statusConfig} columns={{ xs: 2, sm: 4 }} />
      </CardContent>
    </Card>
  );
};

export default ReceivedSectionDashboard;
```

**Estimated Lines:** ~100 lines

---

### 3. AssignedSectionDashboard Component

**File:** `Dashboard/components/AssignedSectionDashboard.js` [CREATE]

**Purpose:** Display "Vi·ªác t√¥i giao" with metrics

```javascript
import React from "react";
import {
  Box,
  Typography,
  Button,
  Card,
  CardContent,
  Grid,
} from "@mui/material";
import StatusGrid from "../../CongViec/components/StatusGrid";

const AssignedSectionDashboard = ({ data, onNavigate }) => {
  const statusConfig = [
    {
      id: "CHUA_GIAO",
      label: "Ch∆∞a giao",
      count: data?.byStatus?.CHUA_GIAO || 0,
      color: "default",
      icon: "üìã",
    },
    {
      id: "DA_GIAO",
      label: "ƒê√£ giao",
      count: data?.byStatus?.DA_GIAO || 0,
      color: "info",
      icon: "üì§",
    },
    {
      id: "DANG_THUC_HIEN",
      label: "ƒêang th·ª±c hi·ªán",
      count: data?.byStatus?.DANG_THUC_HIEN || 0,
      color: "primary",
      icon: "‚ö°",
    },
    {
      id: "HOAN_THANH",
      label: "Ho√†n th√†nh",
      count: data?.byStatus?.HOAN_THANH || 0,
      color: "success",
      icon: "‚úÖ",
    },
    {
      id: "CHO_DUYET",
      label: "Ch·ªù duy·ªát",
      count: data?.byStatus?.CHO_DUYET || 0,
      color: "warning",
      icon: "‚è∞",
    },
    {
      id: "CAN_KIEM_TRA",
      label: "C·∫ßn ki·ªÉm tra",
      count: data?.needCheckCount || 0,
      color: "secondary",
      icon: "üîç",
    },
    {
      id: "AVG_PROGRESS",
      label: "Ti·∫øn ƒë·ªô TB",
      count: `${data?.avgProgress || 0}%`,
      color: "info",
      icon: "üìä",
      isMetric: true,
    },
    {
      id: "ON_TIME_RATE",
      label: "T·ª∑ l·ªá ƒë√∫ng h·∫°n",
      count: `${data?.onTimeRate || 0}%`,
      color: "success",
      icon: "‚è±Ô∏è",
      isMetric: true,
    },
  ];

  return (
    <Card>
      <CardContent>
        <Box
          display="flex"
          justifyContent="space-between"
          alignItems="center"
          mb={2}
        >
          <Typography variant="h6">
            üì§ VI·ªÜC T√îI GIAO ({data?.total || 0})
          </Typography>
          <Button size="small" onClick={() => onNavigate("")}>
            Xem t·∫•t c·∫£ ‚Üí
          </Button>
        </Box>

        <StatusGrid items={statusConfig} columns={{ xs: 2, sm: 4 }} />
      </CardContent>
    </Card>
  );
};

export default AssignedSectionDashboard;
```

---

### 4. DeadlineAlertBanner Component

**File:** `Dashboard/components/DeadlineAlertBanner.js` [CREATE]

**Purpose:** Show urgent/overdue tasks prominently

```javascript
import React from "react";
import { Alert, AlertTitle, Stack, Typography, Chip } from "@mui/material";
import { useNavigate } from "react-router-dom";
import { formatDistanceToNow } from "date-fns";
import { vi } from "date-fns/locale";

const DeadlineAlertBanner = ({ tasks }) => {
  const navigate = useNavigate();

  const getUrgencyColor = (task) => {
    const daysLeft = (new Date(task.NgayHetHan) - new Date()) / 86400000;
    if (daysLeft < 0) return "error";
    if (daysLeft < 1) return "error";
    if (daysLeft < 3) return "warning";
    return "info";
  };

  const getDeadlineText = (deadline) => {
    return formatDistanceToNow(new Date(deadline), {
      addSuffix: true,
      locale: vi,
    });
  };

  return (
    <Alert severity="warning" variant="filled">
      <AlertTitle>‚ö†Ô∏è C·∫¢NH B√ÅO DEADLINE ({tasks.length})</AlertTitle>
      <Stack spacing={1} mt={1}>
        {tasks.slice(0, 3).map((task) => (
          <Box
            key={task._id}
            sx={{
              p: 1,
              bgcolor: "rgba(255,255,255,0.2)",
              borderRadius: 1,
              cursor: "pointer",
              "&:hover": { bgcolor: "rgba(255,255,255,0.3)" },
            }}
            onClick={() => navigate(`/congviec/detail/${task._id}`)}
          >
            <Stack direction="row" alignItems="center" spacing={1}>
              <Typography variant="body2" fontWeight={600} flex={1}>
                {task.TieuDe}
              </Typography>
              <Chip
                label={getDeadlineText(task.NgayHetHan)}
                size="small"
                color={getUrgencyColor(task)}
              />
            </Stack>
          </Box>
        ))}
        {tasks.length > 3 && (
          <Typography variant="caption">
            v√† {tasks.length - 3} vi·ªác kh√°c...
          </Typography>
        )}
      </Stack>
    </Alert>
  );
};

export default DeadlineAlertBanner;
```

---

## üîå API Integration

### Backend API (NEW Method)

**File:** `controllers/dashboard.controller.js` [UPDATE]

**Add Method:**

```javascript
/**
 * GET /api/workmanagement/dashboard/congviec/:nhanVienId
 * Detailed CongViec dashboard for module page
 */
exports.getCongViecDashboard = catchAsync(async (req, res) => {
  const { nhanVienId } = req.params;

  if (!nhanVienId) {
    throw new AppError(400, "NhanVienID is required", "MISSING_PARAM");
  }

  const now = new Date();
  const twoDaysLater = new Date(now.getTime() + 2 * 24 * 60 * 60 * 1000);
  const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);

  // Parallel aggregations for performance
  const [receivedData, assignedData, historyData] = await Promise.all([
    // Received tasks breakdown
    CongViec.aggregate([
      {
        $match: {
          NguoiNhanID: mongoose.Types.ObjectId(nhanVienId),
          isDeleted: { $ne: true },
        },
      },
      {
        $facet: {
          byStatus: [
            {
              $group: {
                _id: "$TrangThai",
                count: { $sum: 1 },
              },
            },
          ],
          total: [{ $count: "count" }],
          overdue: [
            {
              $match: {
                NgayHetHan: { $lt: now },
                TrangThai: { $ne: "HOAN_THANH" },
              },
            },
            { $count: "count" },
            {
              $project: {
                _id: 1,
                TieuDe: 1,
                NgayHetHan: 1,
                MucDoUuTien: 1,
              },
            },
            { $limit: 10 },
          ],
          dueSoon: [
            {
              $match: {
                NgayHetHan: { $gte: now, $lte: twoDaysLater },
                TrangThai: { $ne: "HOAN_THANH" },
              },
            },
            { $count: "count" },
          ],
        },
      },
    ]),

    // Assigned tasks breakdown
    CongViec.aggregate([
      {
        $match: {
          NguoiGiaoID: mongoose.Types.ObjectId(nhanVienId),
          isDeleted: { $ne: true },
        },
      },
      {
        $facet: {
          byStatus: [
            {
              $group: {
                _id: "$TrangThai",
                count: { $sum: 1 },
              },
            },
          ],
          total: [{ $count: "count" }],
          metrics: [
            {
              $group: {
                _id: null,
                avgProgress: { $avg: "$TienDoThucHien" },
                completedOnTime: {
                  $sum: {
                    $cond: [
                      {
                        $and: [
                          { $eq: ["$TrangThai", "HOAN_THANH"] },
                          { $lte: ["$NgayHoanThanh", "$NgayHetHan"] },
                        ],
                      },
                      1,
                      0,
                    ],
                  },
                },
                totalCompleted: {
                  $sum: {
                    $cond: [{ $eq: ["$TrangThai", "HOAN_THANH"] }, 1, 0],
                  },
                },
              },
            },
          ],
          needCheck: [
            {
              $match: {
                TrangThai: "CHO_DUYET",
              },
            },
            { $count: "count" },
          ],
        },
      },
    ]),

    // History (completed this month)
    CongViec.aggregate([
      {
        $match: {
          NguoiNhanID: mongoose.Types.ObjectId(nhanVienId),
          TrangThai: "HOAN_THANH",
          NgayHoanThanh: { $gte: startOfMonth },
        },
      },
      {
        $group: {
          _id: null,
          count: { $sum: 1 },
          avgCompletionDays: {
            $avg: {
              $divide: [
                { $subtract: ["$NgayHoanThanh", "$NgayBatDau"] },
                86400000, // ms to days
              ],
            },
          },
        },
      },
    ]),
  ]);

  // Format response
  const formatStatusCounts = (facetData) => {
    const byStatus = {};
    facetData[0]?.byStatus.forEach((item) => {
      byStatus[item._id] = item.count;
    });
    return byStatus;
  };

  const response = {
    received: {
      total: receivedData[0]?.total[0]?.count || 0,
      byStatus: formatStatusCounts(receivedData),
      overdueCount: receivedData[0]?.overdue[0]?.count || 0,
      overdueTasks: receivedData[0]?.overdue || [],
      dueSoonCount: receivedData[0]?.dueSoon[0]?.count || 0,
    },
    assigned: {
      total: assignedData[0]?.total[0]?.count || 0,
      byStatus: formatStatusCounts(assignedData),
      avgProgress: Math.round(assignedData[0]?.metrics[0]?.avgProgress || 0),
      onTimeRate: Math.round(
        ((assignedData[0]?.metrics[0]?.completedOnTime || 0) /
          (assignedData[0]?.metrics[0]?.totalCompleted || 1)) *
          100
      ),
      needCheckCount: assignedData[0]?.needCheck[0]?.count || 0,
    },
    history: {
      completedThisMonth: historyData[0]?.count || 0,
      avgCompletionTime: Math.round(historyData[0]?.avgCompletionDays || 0),
    },
  };

  return sendResponse(
    res,
    200,
    true,
    response,
    null,
    "L·∫•y CongViec dashboard th√†nh c√¥ng"
  );
});
```

**Route:** `routes/dashboard.route.js` [UPDATE]

```javascript
router.get(
  "/congviec/:nhanVienId",
  loginRequired,
  dashboardController.getCongViecDashboard
);
```

---

### Redux Integration

**File:** `Dashboard/dashboardSlice.js` [UPDATE]

**Add Thunk:**

```javascript
/**
 * Get CongViec dashboard (with cache)
 */
export const getCongViecDashboard =
  (nhanVienId, options = {}) =>
  async (dispatch, getState) => {
    const { refresh = false } = options;

    // Check cache (5 minutes for dashboard)
    const { congViecDashboard, lastCongViecFetch } = getState().dashboard;
    if (!refresh && lastCongViecFetch) {
      const elapsed = Date.now() - new Date(lastCongViecFetch).getTime();
      if (elapsed < 300000) {
        // 5 minutes
        return;
      }
    }

    dispatch(startLoading());

    try {
      const response = await apiService.get(
        `/workmanagement/dashboard/congviec/${nhanVienId}`
      );

      dispatch(getCongViecDashboardSuccess(response.data.data));

      if (refresh) {
        toast.success("ƒê√£ l√†m m·ªõi d·ªØ li·ªáu");
      }

      return response.data.data;
    } catch (error) {
      const errorMessage =
        error.response?.data?.message ||
        error.message ||
        "L·ªói khi t·∫£i dashboard";
      dispatch(hasError(errorMessage));
      toast.error(errorMessage);
      throw error;
    }
  };

// Add reducer
getCongViecDashboardSuccess(state, action) {
  state.isLoading = false;
  state.congViecDashboard = action.payload;
  state.lastCongViecFetch = Date.now();
}

// Add selector
export const selectCongViecDashboard = (state) =>
  state.dashboard.congViecDashboard;
```

---

## üé¨ User Interactions

### Interaction 1: Navigate from Trang Ch·ªß

```
User on UnifiedDashboardPage
   ‚Üì
Tap "C√¥ng vi·ªác" card
   ‚Üì
navigate("/quanlycongviec/cong-viec")
   ‚Üì
CongViecDashboardPage mounts
   ‚Üì
useEffect ‚Üí dispatch(getCongViecDashboard(nhanVienId))
   ‚Üì
API call: GET /dashboard/congviec/:nhanVienId
   ‚Üì
Render StatusGrid + sections
```

### Interaction 2: Tap StatusGrid Card

```
User on CongViecDashboardPage
   ‚Üì
See StatusGrid: "ƒêang l√†m (7)"
   ‚Üì
Tap card
   ‚Üì
onNavigate("status=DANG_THUC_HIEN")
   ‚Üì
navigate("/quanlycongviec/cong-viec-cua-toi?status=DANG_THUC_HIEN")
   ‚Üì
MyTasksPage loads with pre-filtered data
```

### Interaction 3: Deadline Alert Action

```
User sees DeadlineAlertBanner (3 overdue tasks)
   ‚Üì
Tap task item
   ‚Üì
navigate("/congviec/detail/:id")
   ‚Üì
CongViecDetailPage opens
```

---

## ‚úÖ Acceptance Criteria

- [ ] Page loads dashboard data from API on mount
- [ ] 2 StatusGrid sections display (Received + Assigned)
- [ ] Each status card shows correct count from API
- [ ] Tapping status card navigates to filtered list page
- [ ] Deadline alert banner shows when overdue tasks exist
- [ ] Tools menu accessible via button/FAB
- [ ] Mobile: 2-column grid, FAB visible
- [ ] Desktop: 4-column grid, no FAB
- [ ] Refresh button updates data
- [ ] Cache prevents redundant API calls (5 min TTL)

---

**Next:** [Part 4 - Y√™u C·∫ßu & KPI Dashboards ‚Üí](./UI_UX_04_YEUCAU_KPI_DASHBOARDS.md)
