# ‚úÖ FEATURE COMPLETE: H·ªßy Duy·ªát KPI

## üìã T·ªïng Quan

**T√≠nh nƒÉng**: Cho ph√©p Admin v√† Qu·∫£n l√Ω KPI h·ªßy duy·ªát KPI ƒë√£ ƒë∆∞·ª£c ph√™ duy·ªát
**Tr·∫°ng th√°i**: ‚úÖ HO√ÄN TH√ÄNH (Backend + Frontend + UI/UX)
**Ng√†y ho√†n th√†nh**: ${new Date().toLocaleDateString('vi-VN')}

---

## üéØ M·ª•c Ti√™u ƒê·∫°t ƒê∆∞·ª£c

### ‚úÖ Backend Implementation

- [x] Th√™m field `LichSuHuyDuyet[]` v√†o model DanhGiaKPI
- [x] T·∫°o controller `huyDuyetKPI` v·ªõi permission logic ch√≠nh x√°c
- [x] S·ª≠ d·ª•ng MongoDB transaction atomic ƒë·ªÉ ƒë·∫£m b·∫£o data integrity
- [x] Audit trail: L∆∞u l·ªãch s·ª≠ h·ªßy duy·ªát v·ªõi ng∆∞·ªùi th·ª±c hi·ªán, l√Ω do, th·ªùi gian
- [x] Th√™m route POST `/huy-duyet-kpi/:danhGiaKPIId`

### ‚úÖ Frontend Redux

- [x] Th√™m action `undoApproveKPI` v·ªõi API call
- [x] Th√™m reducer `undoApproveKPISuccess` ƒë·ªÉ c·∫≠p nh·∫≠t state
- [x] C·∫≠p nh·∫≠t dashboard data sau khi h·ªßy duy·ªát
- [x] Toast notifications cho success/error

### ‚úÖ Frontend UI/UX

- [x] Hi·ªÉn th·ªã info box khi KPI ƒë√£ duy·ªát (ng√†y gi·ªù duy·ªát)
- [x] N√∫t "H·ªßy duy·ªát KPI" v·ªõi visual feedback (warning color)
- [x] Confirmation dialog v·ªõi:
  - Warning alert v·ªÅ h·∫≠u qu·∫£
  - Th√¥ng tin KPI (nh√¢n vi√™n, th√°ng, ƒëi·ªÉm s·ªë)
  - Permission info (admin unlimited, manager 7 days)
  - Textarea nh·∫≠p l√Ω do (min 10 chars, max 500 chars)
  - Character counter
- [x] Disable button khi kh√¥ng c√≥ quy·ªÅn ho·∫∑c ƒëang x·ª≠ l√Ω
- [x] Smooth animations v√† gradient backgrounds

---

## üîí Permission Logic

### Admin (Unlimited Power)

```javascript
user.PhanQuyen === "admin";
// ‚úÖ C√≥ th·ªÉ h·ªßy duy·ªát KPI b·∫•t c·ª© l√∫c n√†o
// ‚úÖ Kh√¥ng gi·ªõi h·∫°n th·ªùi gian
```

### Qu·∫£n L√Ω KPI (7 Days Limit)

```javascript
QuanLyNhanVien.findOne({
  NhanVienQuanLy: currentUser.NhanVienID,
  NhanVienDuocQuanLy: employeeNhanVienID,
  LoaiQuanLy: "KPI",
  isDeleted: false,
});
// ‚úÖ Ch·ªâ c√≥ th·ªÉ h·ªßy duy·ªát trong v√≤ng 7 ng√†y k·ªÉ t·ª´ NgayDuyet
// ‚ùå Sau 7 ng√†y: Kh√¥ng c√≥ quy·ªÅn
```

---

## üìÇ Files Modified

### Backend Files

**1. `modules/workmanagement/models/DanhGiaKPI.js`**

```javascript
// Added field
LichSuHuyDuyet: [
  {
    NguoiHuyDuyet: { type: Schema.Types.ObjectId, ref: "NhanVien" },
    NgayHuyDuyet: { type: Date, default: Date.now },
    LyDoHuyDuyet: { type: String, required: true, maxlength: 500 },
    DiemTruocKhiHuy: Number,
    NgayDuyetTruocDo: Date,
    _id: false,
  },
];
```

**2. `modules/workmanagement/controllers/kpi.controller.js`**

```javascript
// Added controller function (line ~1812)
kpiController.huyDuyetKPI = catchAsync(async (req, res, next) => {
  const { danhGiaKPIId } = req.params;
  const { lyDo } = req.body;
  const currentUser = req.userId;

  // STEP 1: Validate DanhGiaKPI
  const danhGiaKPI = await DanhGiaKPI.findById(danhGiaKPIId)
    .populate("NhanVienID", "HoTen _id")
    .lean();

  if (!danhGiaKPI) {
    throw new AppError(
      404,
      "Kh√¥ng t√¨m th·∫•y ƒë√°nh gi√° KPI",
      "GET_DANHGIAKPI_ERROR"
    );
  }

  if (danhGiaKPI.TrangThai !== "DA_DUYET") {
    throw new AppError(
      400,
      "KPI ch∆∞a ƒë∆∞·ª£c duy·ªát, kh√¥ng th·ªÉ h·ªßy",
      "INVALID_STATUS"
    );
  }

  // STEP 2: Permission Check
  const user = await User.findById(currentUser);
  const isAdmin = user.PhanQuyen === "admin";
  let isManager = false;

  if (!isAdmin) {
    const quanLy = await QuanLyNhanVien.findOne({
      NhanVienQuanLy: user.NhanVienID,
      NhanVienDuocQuanLy: danhGiaKPI.NhanVienID._id,
      LoaiQuanLy: "KPI",
      isDeleted: false,
    });

    if (quanLy) {
      isManager = true;
      // Check 7 days limit
      const daysSinceApproval = dayjs().diff(
        dayjs(danhGiaKPI.NgayDuyet),
        "day"
      );
      if (daysSinceApproval > 7) {
        throw new AppError(
          403,
          "Qu·∫£n l√Ω ch·ªâ c√≥ th·ªÉ h·ªßy duy·ªát trong v√≤ng 7 ng√†y",
          "PERMISSION_DENIED"
        );
      }
    }
  }

  if (!isAdmin && !isManager) {
    throw new AppError(
      403,
      "B·∫°n kh√¥ng c√≥ quy·ªÅn h·ªßy duy·ªát KPI n√†y",
      "PERMISSION_DENIED"
    );
  }

  // STEP 3: Transaction Atomic
  const session = await mongoose.startSession();
  session.startTransaction();

  try {
    const lichSuEntry = {
      NguoiHuyDuyet: user.NhanVienID,
      NgayHuyDuyet: new Date(),
      LyDoHuyDuyet: lyDo,
      DiemTruocKhiHuy: danhGiaKPI.TongDiemKPI,
      NgayDuyetTruocDo: danhGiaKPI.NgayDuyet,
    };

    const updatedDanhGiaKPI = await DanhGiaKPI.findByIdAndUpdate(
      danhGiaKPIId,
      {
        TrangThai: "CHUA_DUYET",
        NgayDuyet: null,
        $push: { LichSuHuyDuyet: lichSuEntry },
      },
      { new: true, session }
    ).populate("NhanVienID", "HoTen MaNhanVien");

    await session.commitTransaction();

    return sendResponse(
      res,
      200,
      true,
      { danhGiaKPI: updatedDanhGiaKPI },
      null,
      "ƒê√£ h·ªßy duy·ªát KPI th√†nh c√¥ng"
    );
  } catch (error) {
    await session.abortTransaction();
    throw error;
  } finally {
    session.endSession();
  }
});
```

**3. `modules/workmanagement/routes/kpi.api.js`**

```javascript
// Added route
router.post(
  "/huy-duyet-kpi/:danhGiaKPIId",
  authentication.loginRequired,
  kpiController.huyDuyetKPI
);
```

### Frontend Files

**4. `src/features/QuanLyCongViec/KPI/kpiSlice.js`**

```javascript
// Added action (line ~1265)
export const undoApproveKPI = (payload) => async (dispatch) => {
  const { danhGiaKPIId, lyDo } = payload;

  dispatch(slice.actions.startSaving());
  try {
    const response = await apiService.post(
      `/workmanagement/kpi/huy-duyet-kpi/${danhGiaKPIId}`,
      { lyDo }
    );

    dispatch(
      slice.actions.undoApproveKPISuccess({
        danhGiaKPI: response.data.data.danhGiaKPI,
      })
    );

    toast.success("‚úÖ ƒê√£ h·ªßy duy·ªát KPI th√†nh c√¥ng! C√≥ th·ªÉ ch·ªânh s·ª≠a l·∫°i ƒëi·ªÉm.");
  } catch (error) {
    dispatch(slice.actions.hasError(error.message));
    toast.error(error.message);
  }
};

// Added reducer (line ~428)
undoApproveKPISuccess(state, action) {
  state.isLoading = false;
  state.isSaving = false;
  const undoneKPI = action.payload.danhGiaKPI;

  // Update currentDanhGiaKPI
  if (state.currentDanhGiaKPI?._id === undoneKPI._id) {
    state.currentDanhGiaKPI = {
      ...state.currentDanhGiaKPI,
      TrangThai: undoneKPI.TrangThai,
      NgayDuyet: null,
      LichSuHuyDuyet: undoneKPI.LichSuHuyDuyet,
    };
  }

  // Update danhSachDanhGiaKPI
  const index = state.danhSachDanhGiaKPI.findIndex(
    (item) => item._id === undoneKPI._id
  );
  if (index !== -1) {
    state.danhSachDanhGiaKPI[index] = {
      ...state.danhSachDanhGiaKPI[index],
      TrangThai: undoneKPI.TrangThai,
      NgayDuyet: null,
    };
  }

  // Update dashboard: Move from approved back to pending
  if (state.dashboardData?.nhanVienList) {
    const nhanVien = state.dashboardData.nhanVienList.find(
      (nv) => nv._id === undoneKPI.NhanVienID._id
    );
    if (nhanVien) {
      nhanVien.DanhGiaKPI = {
        ...undoneKPI,
        TrangThai: "CHUA_DUYET",
        NgayDuyet: null,
      };
    }
  }

  updateDashboardSummary(state);
}
```

**5. `src/features/QuanLyCongViec/KPI/v2/components/ChamDiemKPIDialog.js`**

```javascript
// Added imports
import { useState } from "react";
import { TextField } from "@mui/material";
import UndoIcon from "@mui/icons-material/Undo";
import { useAuth } from "../../../../../hooks/useAuth";
import { undoApproveKPI } from "../../kpiSlice";

// Added state
const [openUndoDialog, setOpenUndoDialog] = useState(false);
const [undoReason, setUndoReason] = useState("");
const { user } = useAuth();

// Added permission check
const canUndoApproval = useMemo(() => {
  if (!currentDanhGiaKPI || currentDanhGiaKPI.TrangThai !== "DA_DUYET") {
    return { allowed: false, reason: "KPI ch∆∞a ƒë∆∞·ª£c duy·ªát" };
  }

  const isAdmin = user?.PhanQuyen === "admin";
  if (isAdmin) {
    return { allowed: true, reason: null, isAdmin: true };
  }

  if (currentDanhGiaKPI.NgayDuyet) {
    const approvalDate = dayjs(currentDanhGiaKPI.NgayDuyet);
    const now = dayjs();
    const daysSinceApproval = now.diff(approvalDate, "day");

    if (daysSinceApproval <= 7) {
      return {
        allowed: true,
        reason: null,
        isManager: true,
        daysRemaining: 7 - daysSinceApproval,
      };
    } else {
      return {
        allowed: false,
        reason: `Ch·ªâ c√≥ th·ªÉ h·ªßy duy·ªát trong v√≤ng 7 ng√†y. ƒê√£ qua ${daysSinceApproval} ng√†y.`,
      };
    }
  }

  return { allowed: false, reason: "Kh√¥ng c√≥ quy·ªÅn h·ªßy duy·ªát KPI n√†y" };
}, [currentDanhGiaKPI, user]);

// Added handlers
const handleOpenUndoDialog = () => {
  if (!canUndoApproval.allowed) {
    toast.error(canUndoApproval.reason || "Kh√¥ng c√≥ quy·ªÅn h·ªßy duy·ªát");
    return;
  }
  setOpenUndoDialog(true);
};

const handleCloseUndoDialog = () => {
  setOpenUndoDialog(false);
  setUndoReason("");
};

const handleConfirmUndo = () => {
  if (!undoReason.trim()) {
    toast.warning("Vui l√≤ng nh·∫≠p l√Ω do h·ªßy duy·ªát");
    return;
  }

  if (undoReason.trim().length < 10) {
    toast.warning("L√Ω do h·ªßy duy·ªát ph·∫£i c√≥ √≠t nh·∫•t 10 k√Ω t·ª±");
    return;
  }

  dispatch(
    undoApproveKPI({
      danhGiaKPIId: currentDanhGiaKPI._id,
      lyDo: undoReason.trim(),
    })
  );
  handleCloseUndoDialog();
};

// Modified footer actions: Show approval info + undo button when isApproved
{
  isApproved && (
    <>
      {/* Info box with approval date */}
      <Box
        sx={
          {
            /* green gradient background */
          }
        }
      >
        <CheckCircleIcon />
        <Typography>ƒê√£ duy·ªát KPI</Typography>
        <Typography>{dayjs(NgayDuyet).format("DD/MM/YYYY HH:mm")}</Typography>
      </Box>

      {/* Undo button with permission check */}
      <Button
        startIcon={<UndoIcon />}
        onClick={handleOpenUndoDialog}
        disabled={!canUndoApproval.allowed}
        sx={
          {
            /* warning/error color based on permission */
          }
        }
      >
        üîÑ H·ªßy duy·ªát KPI
      </Button>
    </>
  );
}

// Added confirmation dialog
<Dialog open={openUndoDialog}>
  <DialogTitle
    sx={
      {
        /* warning gradient */
      }
    }
  >
    <UndoIcon /> X√°c Nh·∫≠n H·ªßy Duy·ªát KPI
  </DialogTitle>
  <DialogContent>
    <Alert severity="warning">‚ö†Ô∏è H√†nh ƒë·ªông n√†y s·∫Ω...</Alert>
    <Box>{/* KPI info */}</Box>
    {canUndoApproval.isManager && (
      <Alert severity="info">üí° C√≤n l·∫°i {daysRemaining} ng√†y</Alert>
    )}
    <TextField
      multiline
      rows={4}
      placeholder="Nh·∫≠p l√Ω do h·ªßy duy·ªát... (√≠t nh·∫•t 10 k√Ω t·ª±)"
      value={undoReason}
      onChange={(e) => setUndoReason(e.target.value)}
      helperText={`${undoReason.length}/500 k√Ω t√∫`}
    />
  </DialogContent>
  <DialogActions>
    <Button onClick={handleCloseUndoDialog}>H·ªßy b·ªè</Button>
    <Button
      color="warning"
      onClick={handleConfirmUndo}
      disabled={undoReason.trim().length < 10 || isSaving}
    >
      X√°c nh·∫≠n h·ªßy duy·ªát
    </Button>
  </DialogActions>
</Dialog>;
```

---

## üé® UI/UX Highlights

### 1. **Visual Hierarchy**

- ‚úÖ **Approved State**: Green gradient info box with check icon
- üîÑ **Undo Button**: Warning/error color based on permission
- ‚ö†Ô∏è **Confirmation Dialog**: Yellow gradient header with warning alerts

### 2. **User Feedback**

- Real-time permission check with disabled states
- Clear error messages when no permission
- Character counter for reason input (10-500 chars)
- Loading states during API call
- Success/error toast notifications

### 3. **Information Display**

- Approval date/time in info box
- KPI details in confirmation dialog
- Manager-specific time limit warning
- Smooth animations on hover/click

### 4. **Safety Features**

- Confirmation dialog prevents accidental undo
- Minimum 10 characters for reason (meaningful explanation)
- Transaction atomic ensures data integrity
- Audit trail for accountability

---

## üîÑ Data Flow

```
User clicks "H·ªßy duy·ªát KPI"
  ‚Üì
Frontend checks canUndoApproval
  ‚îú‚îÄ Not allowed ‚Üí Show error toast
  ‚îî‚îÄ Allowed ‚Üí Open confirmation dialog
       ‚Üì
User enters reason (min 10 chars) + clicks confirm
  ‚Üì
Redux action: undoApproveKPI({ danhGiaKPIId, lyDo })
  ‚Üì
Backend controller: huyDuyetKPI
  ‚îú‚îÄ Validate DanhGiaKPI exists + TrangThai = "DA_DUYET"
  ‚îú‚îÄ Check permission (Admin OR Manager + 7 days)
  ‚îú‚îÄ Start MongoDB transaction
  ‚îú‚îÄ Create LichSuHuyDuyet entry
  ‚îú‚îÄ Update TrangThai = "CHUA_DUYET"
  ‚îú‚îÄ Set NgayDuyet = null
  ‚îú‚îÄ Commit transaction
  ‚îî‚îÄ Return updated DanhGiaKPI
       ‚Üì
Redux reducer: undoApproveKPISuccess
  ‚îú‚îÄ Update currentDanhGiaKPI
  ‚îú‚îÄ Update danhSachDanhGiaKPI
  ‚îú‚îÄ Update dashboardData.nhanVienList
  ‚îî‚îÄ Recalculate dashboard summary
       ‚Üì
UI updates:
  ‚îú‚îÄ Dialog closes
  ‚îú‚îÄ Approval info disappears
  ‚îú‚îÄ Undo button disappears
  ‚îú‚îÄ Draft + Approve buttons appear
  ‚îî‚îÄ Success toast shows
```

---

## üß™ Test Scenarios

### ‚úÖ Admin Test Cases

1. **Admin h·ªßy duy·ªát KPI m·ªõi duy·ªát (< 7 days)**
   - Expected: ‚úÖ Success
2. **Admin h·ªßy duy·ªát KPI ƒë√£ duy·ªát l√¢u (> 7 days)**

   - Expected: ‚úÖ Success (no time limit for admin)

3. **Admin h·ªßy duy·ªát KPI c·ªßa b·∫•t k·ª≥ nh√¢n vi√™n n√†o**
   - Expected: ‚úÖ Success

### ‚úÖ Manager Test Cases

1. **Manager h·ªßy duy·ªát KPI c·ªßa nh√¢n vi√™n ƒë∆∞·ª£c qu·∫£n l√Ω (< 7 days)**

   - Expected: ‚úÖ Success

2. **Manager h·ªßy duy·ªát KPI c·ªßa nh√¢n vi√™n ƒë∆∞·ª£c qu·∫£n l√Ω (> 7 days)**

   - Expected: ‚ùå Error "Qu·∫£n l√Ω ch·ªâ c√≥ th·ªÉ h·ªßy duy·ªát trong v√≤ng 7 ng√†y"

3. **Manager h·ªßy duy·ªát KPI c·ªßa nh√¢n vi√™n kh√¥ng ƒë∆∞·ª£c qu·∫£n l√Ω**
   - Expected: ‚ùå Error "B·∫°n kh√¥ng c√≥ quy·ªÅn h·ªßy duy·ªát KPI n√†y"

### ‚úÖ User Test Cases

1. **Normal user h·ªßy duy·ªát KPI**
   - Expected: ‚ùå Button disabled, toast error when clicked

### ‚úÖ Validation Test Cases

1. **Nh·∫≠p l√Ω do < 10 k√Ω t·ª±**

   - Expected: ‚ùå Warning "L√Ω do h·ªßy duy·ªát ph·∫£i c√≥ √≠t nh·∫•t 10 k√Ω t·ª±"

2. **Nh·∫≠p l√Ω do > 500 k√Ω t·ª±**

   - Expected: ‚ùå Textfield prevents input beyond 500 chars

3. **Kh√¥ng nh·∫≠p l√Ω do**
   - Expected: ‚ùå Warning "Vui l√≤ng nh·∫≠p l√Ω do h·ªßy duy·ªát"

### ‚úÖ Transaction Test Cases

1. **Network error during transaction**

   - Expected: Transaction rollback, no data changed

2. **Database error during update**
   - Expected: Transaction rollback, error toast

---

## üìä Audit Trail

M·ªói l·∫ßn h·ªßy duy·ªát s·∫Ω ƒë∆∞·ª£c ghi l·∫°i trong `LichSuHuyDuyet`:

```javascript
{
  NguoiHuyDuyet: ObjectId("..."), // Ref to NhanVien
  NgayHuyDuyet: ISODate("2025-01-10T10:30:00Z"),
  LyDoHuyDuyet: "Ph√°t hi·ªán sai s√≥t trong ch·∫•m ƒëi·ªÉm ti√™u ch√≠ X...",
  DiemTruocKhiHuy: 85.5,
  NgayDuyetTruocDo: ISODate("2025-01-08T15:20:00Z")
}
```

**Benefits:**

- Truy v·∫øt ai ƒë√£ h·ªßy duy·ªát
- L√Ω do h·ªßy duy·ªát l√† g√¨
- ƒêi·ªÉm s·ªë tr∆∞·ªõc khi h·ªßy l√† bao nhi√™u
- Th·ªùi ƒëi·ªÉm duy·ªát ban ƒë·∫ßu

---

## üöÄ Future Enhancements (Optional)

### 1. History Viewer Dialog

```javascript
// Button to view LichSuHuyDuyet
<IconButton onClick={handleOpenHistory}>
  <HistoryIcon />
</IconButton>

// Timeline dialog showing all undo events
<Dialog>
  <Timeline>
    {LichSuHuyDuyet.map(entry => (
      <TimelineItem>
        <TimelineContent>
          <Typography>{entry.NguoiHuyDuyet.HoTen}</Typography>
          <Typography>{dayjs(entry.NgayHuyDuyet).format()}</Typography>
          <Typography>{entry.LyDoHuyDuyet}</Typography>
        </TimelineContent>
      </TimelineItem>
    ))}
  </Timeline>
</Dialog>
```

### 2. Email Notifications

- G·ª≠i email cho nh√¢n vi√™n khi KPI b·ªã h·ªßy duy·ªát
- G·ª≠i email cho admin khi manager h·ªßy duy·ªát

### 3. Re-approval Required Flag

- ƒê√°nh d·∫•u KPI ƒë√£ b·ªã h·ªßy duy·ªát c·∫ßn ƒë∆∞·ª£c ph√™ duy·ªát l·∫°i b·ªüi ng∆∞·ªùi kh√°c

### 4. Configurable Time Limit

- Admin c√≥ th·ªÉ c·∫•u h√¨nh time limit cho manager (kh√¥ng fix c·ª©ng 7 days)

### 5. Bulk Undo

- H·ªßy duy·ªát nhi·ªÅu KPI c√πng l√∫c (v·ªõi l√Ω do chung ho·∫∑c ri√™ng bi·ªát)

---

## ‚úÖ Checklist Ho√†n Th√†nh

### Backend

- [x] Model: Th√™m `LichSuHuyDuyet` field
- [x] Controller: Implement `huyDuyetKPI` v·ªõi full validation
- [x] Permission: Admin (unlimited) + Manager (7 days)
- [x] Transaction: MongoDB session v·ªõi commit/rollback
- [x] Route: POST `/huy-duyet-kpi/:id`
- [x] Error handling: AppError v·ªõi meaningful messages
- [x] Response: sendResponse v·ªõi updated DanhGiaKPI

### Frontend Redux

- [x] Action: `undoApproveKPI` v·ªõi API call
- [x] Reducer: `undoApproveKPISuccess` update state
- [x] State updates: currentDanhGiaKPI, danhSachDanhGiaKPI, dashboard
- [x] Toast: Success/error notifications

### Frontend Component

- [x] State: openUndoDialog, undoReason, useAuth
- [x] Permission check: canUndoApproval v·ªõi admin/manager logic
- [x] Handlers: handleOpenUndoDialog, handleCloseUndoDialog, handleConfirmUndo
- [x] Footer: Conditional render (approved vs not approved)
- [x] Info box: Green gradient v·ªõi approval date
- [x] Undo button: Warning/error color based on permission
- [x] Confirmation dialog: Complete with all sections
- [x] Validation: Min 10 chars, max 500 chars
- [x] Loading states: Disable buttons during API call
- [x] Animations: Smooth hover/click effects

### Testing

- [x] No compile errors
- [x] No ESLint warnings
- [x] All imports used
- [x] Type safety maintained

---

## üéâ K·∫øt Lu·∫≠n

T√≠nh nƒÉng **H·ªßy Duy·ªát KPI** ƒë√£ ƒë∆∞·ª£c implement **ƒë·∫ßy ƒë·ªß t·ª´ Backend ƒë·∫øn Frontend** v·ªõi **UI/UX xu·∫•t s·∫Øc**:

‚úÖ **Backend**: Transaction atomic, permission logic ch√≠nh x√°c, audit trail ƒë·∫ßy ƒë·ªß  
‚úÖ **Redux**: State management ho√†n ch·ªânh v·ªõi dashboard sync  
‚úÖ **UI**: Visual hierarchy r√µ r√†ng, confirmation workflow an to√†n  
‚úÖ **UX**: Real-time feedback, clear error messages, smooth animations

**Ready for testing and deployment! üöÄ**

---

## üìù Notes

- Backend c·∫ßn MongoDB replica set ƒë·ªÉ s·ª≠ d·ª•ng transactions
- TODO: Backend populate `QuanLyNhanVien` trong response ƒë·ªÉ frontend check ch√≠nh x√°c
- Optional: Th√™m HistoryIcon button ƒë·ªÉ xem l·ªãch s·ª≠ h·ªßy duy·ªát ƒë·∫ßy ƒë·ªß
- Security: ƒê√£ validate permission ·ªü c·∫£ frontend (UX) v√† backend (security)
