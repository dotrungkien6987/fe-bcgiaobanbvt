# Quy Tr√¨nh Nghi·ªáp V·ª• - GiaoNhiemVu V3.0

**Phi√™n b·∫£n:** 3.0  
**C·∫≠p nh·∫≠t:** 26/11/2025

---

## üìã M·ª•c L·ª•c

- [T·ªïng Quan Quy Tr√¨nh](#t·ªïng-quan-quy-tr√¨nh)
- [Quy Tr√¨nh 1: Qu·∫£n L√Ω G√°n Nhi·ªám V·ª•](#quy-tr√¨nh-1-qu·∫£n-l√Ω-g√°n-nhi·ªám-v·ª•)
- [Quy Tr√¨nh 2: Nh√¢n Vi√™n T·ª± ƒê√°nh Gi√°](#quy-tr√¨nh-2-nh√¢n-vi√™n-t·ª±-ƒë√°nh-gi√°)
- [Quy Tr√¨nh 3: Qu·∫£n L√Ω Ch·∫•m ƒêi·ªÉm KPI](#quy-tr√¨nh-3-qu·∫£n-l√Ω-ch·∫•m-ƒëi·ªÉm-kpi)
- [Quy Tr√¨nh 4: Sao Ch√©p Chu K·ª≥](#quy-tr√¨nh-4-sao-ch√©p-chu-k·ª≥)
- [C√°c T√¨nh Hu·ªëng ƒê·∫∑c Bi·ªát](#c√°c-t√¨nh-hu·ªëng-ƒë·∫∑c-bi·ªát)

---

## üéØ T·ªïng Quan Quy Tr√¨nh

### V√≤ng ƒê·ªùi Ph√¢n C√¥ng Nhi·ªám V·ª•

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  GIAI ƒêO·∫†N 1: CHU·∫®N B·ªä CHU K·ª≤                              ‚îÇ
‚îÇ  - Admin t·∫°o chu k·ª≥ ƒë√°nh gi√° (ChuKyDanhGia)                ‚îÇ
‚îÇ  - M·ªü chu k·ª≥ (isDong = false)                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  GIAI ƒêO·∫†N 2: PH√ÇN C√îNG NHI·ªÜM V·ª§                           ‚îÇ
‚îÇ  - Qu·∫£n l√Ω g√°n nhi·ªám v·ª• cho nh√¢n vi√™n                      ‚îÇ
‚îÇ  - Ch·ªânh ƒë·ªô kh√≥ (0-2)                                      ‚îÇ
‚îÇ  - C√≥ th·ªÉ sao ch√©p t·ª´ chu k·ª≥ tr∆∞·ªõc                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  GIAI ƒêO·∫†N 3: T·ª∞ ƒê√ÅNH GI√Å                                  ‚îÇ
‚îÇ  - Nh√¢n vi√™n t·ª± ch·∫•m ƒëi·ªÉm (0-100%)                         ‚îÇ
‚îÇ  - C√≥ th·ªÉ ch·ªânh s·ª≠a nhi·ªÅu l·∫ßn trong chu k·ª≥                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  GIAI ƒêO·∫†N 4: QU·∫¢N L√ù CH·∫§M ƒêI·ªÇM                            ‚îÇ
‚îÇ  - Qu·∫£n l√Ω ch·∫•m ƒëi·ªÉm chi ti·∫øt cho t·ª´ng nhi·ªám v·ª•            ‚îÇ
‚îÇ  - T√≠nh to√°n KPI t·ª± ƒë·ªông                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  GIAI ƒêO·∫†N 5: DUY·ªÜT KPI                                    ‚îÇ
‚îÇ  - Qu·∫£n l√Ω/Admin duy·ªát KPI                                 ‚îÇ
‚îÇ  - Kh√≥a ch·ªânh s·ª≠a (TrangThai = "DA_DUYET")                 ‚îÇ
‚îÇ  - L∆∞u snapshot ƒëi·ªÉm v√†o TongDiemKPI                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  GIAI ƒêO·∫†N 6: ƒê√ìNG CHU K·ª≤                                  ‚îÇ
‚îÇ  - Admin ƒë√≥ng chu k·ª≥ (isDong = true)                       ‚îÇ
‚îÇ  - Kh√¥ng th·ªÉ thay ƒë·ªïi ph√¢n c√¥ng                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä Quy Tr√¨nh 1: Qu·∫£n L√Ω G√°n Nhi·ªám V·ª•

### B∆∞·ªõc 1: Truy C·∫≠p Trang Ph√¢n C√¥ng

**Ng∆∞·ªùi d√πng:** Qu·∫£n l√Ω (Manager)  
**Menu:** `Qu·∫£n l√Ω c√¥ng vi·ªác > üìÖ Ph√¢n c√¥ng theo chu k·ª≥`

1. Click menu "üìÖ Ph√¢n c√¥ng theo chu k·ª≥"
2. H·ªá th·ªëng ƒëi·ªÅu h∆∞·ªõng ƒë·∫øn `/quanlycongviec/giao-nhiem-vu-chu-ky`
3. Trang hi·ªÉn th·ªã dropdown ch·ªçn chu k·ª≥

---

### B∆∞·ªõc 2: Ch·ªçn Chu K·ª≥

**UI:** Dropdown autocomplete

1. Click dropdown "Ch·ªçn chu k·ª≥"
2. Danh s√°ch hi·ªÉn th·ªã:
   - Qu√Ω 1/2025 (01/01/2025 - 31/03/2025) üü¢ ƒêang m·ªü
   - Qu√Ω 4/2024 (01/10/2024 - 31/12/2024) üîí ƒê√£ ƒë√≥ng
   - Qu√Ω 3/2024 (01/07/2024 - 30/09/2024) üîí ƒê√£ ƒë√≥ng
3. Ch·ªçn chu k·ª≥ "Qu√Ω 1/2025"
4. H·ªá th·ªëng g·ªçi API:
   ```
   GET /workmanagement/giao-nhiem-vu/employees-with-cycle-stats?chuKyId=xxx
   ```
5. B·∫£ng danh s√°ch nh√¢n vi√™n hi·ªÉn th·ªã v·ªõi th·ªëng k√™

---

### B∆∞·ªõc 3: Xem Danh S√°ch Nh√¢n Vi√™n

**UI:** B·∫£ng v·ªõi 5 c·ªôt

| T√™n nh√¢n vi√™n | M√£ NV | ƒê√£ g√°n | T·ªïng MƒêK | Thao t√°c |
| ------------- | ----- | ------ | -------- | -------- |
| Nguy·ªÖn VƒÉn A  | NV001 | 5/12   | 8.5      | [G√°n]    |
| Tr·∫ßn Th·ªã B    | NV002 | 3/12   | 5.0      | [G√°n]    |
| L√™ VƒÉn C      | NV003 | 0/12   | 0.0      | [G√°n]    |

**√ù nghƒ©a c√°c c·ªôt:**

- **ƒê√£ g√°n:** S·ªë nhi·ªám v·ª• ƒë√£ g√°n / T·ªïng s·ªë nhi·ªám v·ª• kh·∫£ d·ª•ng
- **T·ªïng MƒêK:** T·ªïng m·ª©c ƒë·ªô kh√≥ (sum c·ªßa t·∫•t c·∫£ nhi·ªám v·ª• ƒë√£ g√°n)

---

### B∆∞·ªõc 4: G√°n Nhi·ªám V·ª• Chi Ti·∫øt

**UI:** Giao di·ªán hai c·ªôt

1. Click n√∫t [G√°n] tr√™n d√≤ng "Nguy·ªÖn VƒÉn A"
2. H·ªá th·ªëng ƒëi·ªÅu h∆∞·ªõng:
   ```
   /quanlycongviec/giao-nhiem-vu-chu-ky/66b1dba74f79822a4752d90a?chuKyId=xxx
   ```
3. Trang chi ti·∫øt hi·ªÉn th·ªã:
   - **C·ªôt tr√°i:** Nhi·ªám v·ª• kh·∫£ d·ª•ng (checkbox + slider)
   - **C·ªôt ph·∫£i:** Nhi·ªám v·ª• ƒë√£ g√°n (card + n√∫t x√≥a)

---

### B∆∞·ªõc 5: Th√™m Nhi·ªám V·ª• M·ªõi

**Lu·ªìng:**

```
1. Tick checkbox "Ki·ªÉm tra h·ªì s∆° b·ªánh √°n"
   ‚Üí Slider ƒë·ªô kh√≥ hi·ªÉn th·ªã b√™n d∆∞·ªõi (m·∫∑c ƒë·ªãnh = 1.0)

2. K√©o slider ƒë·∫øn m·ª©c ƒë·ªô kh√≥ mong mu·ªën (VD: 1.5)
   ‚Üí Nhi·ªám v·ª• t·ª± ƒë·ªông th√™m v√†o c·ªôt ph·∫£i

3. X√°c nh·∫≠n th√¥ng tin:
   - T√™n: Ki·ªÉm tra h·ªì s∆° b·ªánh √°n
   - ƒê·ªô kh√≥: 1.5
   - ƒêi·ªÉm t·ª± ƒë√°nh gi√°: 0%
```

**L∆∞u √Ω:**

- ‚úÖ C√≥ th·ªÉ tick nhi·ªÅu checkbox c√πng l√∫c
- ‚úÖ Slider c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh sau khi tick
- ‚úÖ Nhi·ªám v·ª• ch∆∞a ƒë∆∞·ª£c l∆∞u database (ch·ªâ update UI)

---

### B∆∞·ªõc 6: Ch·ªânh S·ª≠a ƒê·ªô Kh√≥

**UI:** Slider tr√™n card nhi·ªám v·ª• (c·ªôt ph·∫£i)

1. T√¨m nhi·ªám v·ª• "ChƒÉm s√≥c b·ªánh nh√¢n" trong c·ªôt ph·∫£i
2. K√©o slider t·ª´ 1.5 ‚Üí 2.0
3. H·ªá th·ªëng c·∫≠p nh·∫≠t state local ngay l·∫≠p t·ª©c

---

### B∆∞·ªõc 7: X√≥a Nhi·ªám V·ª•

**UI:** N√∫t [√ó] tr√™n card nhi·ªám v·ª•

**Lu·ªìng:**

```
1. Click n√∫t [√ó] b√™n c·∫°nh "L·∫≠p k·∫ø ho·∫°ch ƒëi·ªÅu tr·ªã"

2. H·ªá th·ªëng ki·ªÉm tra tr∆∞·ªõc (canDeleteDuty):
   - C√≥ ƒëi·ªÉm t·ª± ƒë√°nh gi√°? ‚Üí Hi·ªÉn th·ªã c·∫£nh b√°o
   - C√≥ ƒëi·ªÉm qu·∫£n l√Ω? ‚Üí Hi·ªÉn th·ªã c·∫£nh b√°o (TODO: c·∫ßn g·ªçi API)

3. N·∫øu PASS ki·ªÉm tra:
   ‚Üí X√≥a kh·ªèi c·ªôt ph·∫£i
   ‚Üí B·ªè tick checkbox c·ªôt tr√°i (n·∫øu c√≥)
```

**Th√¥ng b√°o l·ªói:**

```javascript
// C√≥ ƒëi·ªÉm t·ª± ƒë√°nh gi√°
toast.error(
  'Kh√¥ng th·ªÉ x√≥a nhi·ªám v·ª• "L·∫≠p k·∫ø ho·∫°ch ƒëi·ªÅu tr·ªã". ' +
    "Nhi·ªám v·ª• ƒë√£ c√≥ ƒëi·ªÉm t·ª± ƒë√°nh gi√° (75 ƒëi·ªÉm)."
);

// Gi·∫£i ph√°p: Nh√¢n vi√™n ph·∫£i ƒë∆∞a ƒëi·ªÉm v·ªÅ 0 tr√™n trang "T·ª± ƒë√°nh gi√° KPI"
```

---

### B∆∞·ªõc 8: L∆∞u T·∫•t C·∫£ Thay ƒê·ªïi

**UI:** N√∫t [L∆∞u t·∫•t c·∫£]

**Lu·ªìng:**

```
1. Click n√∫t [L∆∞u t·∫•t c·∫£]

2. H·ªá th·ªëng ph√¢n lo·∫°i thay ƒë·ªïi:
   - assignmentsToAdd: Nhi·ªám v·ª• m·ªõi th√™m (c√≥ _tempId)
   - assignmentsToUpdate: Nhi·ªám v·ª• thay ƒë·ªïi ƒë·ªô kh√≥
   - assignmentsToDelete: Nhi·ªám v·ª• b·ªã x√≥a

3. G·ªçi API:
   PUT /nhan-vien/:id/cycle-assignments
   Body: { chuKyId, assignmentsToAdd, assignmentsToUpdate, assignmentsToDelete }

4. Backend ki·ªÉm tra 4-layer validation:
   ‚úÖ Chu k·ª≥ ch∆∞a ƒë√≥ng
   ‚úÖ KPI ch∆∞a duy·ªát
   ‚úÖ Kh√¥ng c√≥ ƒëi·ªÉm t·ª± ƒë√°nh gi√° (khi x√≥a)
   ‚úÖ Kh√¥ng c√≥ ƒëi·ªÉm qu·∫£n l√Ω (khi x√≥a)

5. N·∫øu PASS:
   ‚Üí Transaction MongoDB (add + update + delete)
   ‚Üí Tr·∫£ v·ªÅ danh s√°ch c·∫≠p nh·∫≠t
   ‚Üí Redux state update
   ‚Üí Toast th√¥ng b√°o "C·∫≠p nh·∫≠t nhi·ªám v·ª• th√†nh c√¥ng!"

6. N·∫øu FAIL:
   ‚Üí Hi·ªÉn th·ªã th√¥ng b√°o l·ªói c·ª• th·ªÉ
   ‚Üí Gi·ªØ nguy√™n state local
```

---

## üë§ Quy Tr√¨nh 2: Nh√¢n Vi√™n T·ª± ƒê√°nh Gi√°

### B∆∞·ªõc 1: Truy C·∫≠p Trang T·ª± ƒê√°nh Gi√°

**Ng∆∞·ªùi d√πng:** Nh√¢n vi√™n (Employee)  
**Menu:** `Qu·∫£n l√Ω c√¥ng vi·ªác > T·ª± ƒë√°nh gi√° KPI` üÜï

1. Click menu "T·ª± ƒë√°nh gi√° KPI"
2. H·ªá th·ªëng ƒëi·ªÅu h∆∞·ªõng ƒë·∫øn `/quanlycongviec/kpi/tu-danh-gia`
3. Dropdown t·ª± ƒë·ªông ch·ªçn chu k·ª≥ ƒëang m·ªü

---

### B∆∞·ªõc 2: Ch·ªçn Chu K·ª≥ (N·∫øu c·∫ßn)

**UI:** Dropdown autocomplete

1. Dropdown hi·ªÉn th·ªã danh s√°ch chu k·ª≥
2. M·∫∑c ƒë·ªãnh ch·ªçn chu k·ª≥ ƒëang m·ªü (isDong = false)
3. C√≥ th·ªÉ ch·ªçn chu k·ª≥ kh√°c ƒë·ªÉ xem l·ªãch s·ª≠

---

### B∆∞·ªõc 3: Xem Danh S√°ch Nhi·ªám V·ª•

**UI:** Danh s√°ch card (Paper)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ChƒÉm s√≥c b·ªánh nh√¢n (ƒê·ªô kh√≥: 1.5)                     ‚îÇ
‚îÇ  M√¥ t·∫£: ChƒÉm s√≥c to√†n di·ªán b·ªánh nh√¢n...                ‚îÇ
‚îÇ  ƒêi·ªÉm t·ª± ƒë√°nh gi√°: ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óã (85%)                  ‚îÇ
‚îÇ  [0%]‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ[50%]‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ[100%]                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  L·∫≠p k·∫ø ho·∫°ch ƒëi·ªÅu tr·ªã (ƒê·ªô kh√≥: 2.0)                 ‚îÇ
‚îÇ  M√¥ t·∫£: L·∫≠p k·∫ø ho·∫°ch ƒëi·ªÅu tr·ªã cho b·ªánh nh√¢n m·ªõi...    ‚îÇ
‚îÇ  ƒêi·ªÉm t·ª± ƒë√°nh gi√°: ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óã (0%)                    ‚îÇ
‚îÇ  [0%]‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ[50%]‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ[100%]                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Th√¥ng tin hi·ªÉn th·ªã:**

- T√™n nhi·ªám v·ª• + ƒê·ªô kh√≥ (Chip)
- M√¥ t·∫£ nhi·ªám v·ª•
- Slider ƒëi·ªÉm t·ª± ƒë√°nh gi√° (0-100%)
- Thanh progress t·ªïng th·ªÉ

---

### B∆∞·ªõc 4: T·ª± Ch·∫•m ƒêi·ªÉm

**UI:** Slider (0-100%)

**H∆∞·ªõng d·∫´n ch·∫•m ƒëi·ªÉm:**

| ƒêi·ªÉm        | √ù nghƒ©a               | V√≠ d·ª•                                  |
| ----------- | --------------------- | -------------------------------------- |
| **0-20%**   | Kh√¥ng ho√†n th√†nh      | Ch∆∞a b·∫Øt ƒë·∫ßu ho·∫∑c ch·ªâ l√†m ƒë∆∞·ª£c r·∫•t √≠t  |
| **21-40%**  | Ho√†n th√†nh k√©m        | L√†m ƒë∆∞·ª£c m·ªôt ph·∫ßn nh·ªè, nhi·ªÅu thi·∫øu s√≥t |
| **41-60%**  | Ho√†n th√†nh trung b√¨nh | L√†m ƒë∆∞·ª£c kho·∫£ng m·ªôt n·ª≠a                |
| **61-80%**  | Ho√†n th√†nh t·ªët        | L√†m ƒë∆∞·ª£c ph·∫ßn l·ªõn, √≠t thi·∫øu s√≥t        |
| **81-100%** | Ho√†n th√†nh xu·∫•t s·∫Øc   | L√†m ho√†n ch·ªânh, v∆∞·ª£t mong ƒë·ª£i          |

**Lu·ªìng ch·∫•m ƒëi·ªÉm:**

```
1. K√©o slider "ChƒÉm s√≥c b·ªánh nh√¢n" ‚Üí 85%
   ‚Üí State local c·∫≠p nh·∫≠t ngay

2. K√©o slider "L·∫≠p k·∫ø ho·∫°ch ƒëi·ªÅu tr·ªã" ‚Üí 75%
   ‚Üí State local c·∫≠p nh·∫≠t ngay

3. Thanh progress c·∫≠p nh·∫≠t: 2/2 nhi·ªám v·ª• (100%)
```

---

### B∆∞·ªõc 5: L∆∞u ƒêi·ªÉm

**UI:** N√∫t [L∆∞u t·∫•t c·∫£]

**Lu·ªìng:**

```
1. Click n√∫t [L∆∞u t·∫•t c·∫£]

2. H·ªá th·ªëng l·ªçc ƒëi·ªÉm thay ƒë·ªïi:
   - So s√°nh localState vs originalState
   - Ch·ªâ g·ª≠i nh·ªØng ƒëi·ªÉm thay ƒë·ªïi

3. G·ªçi API:
   POST /tu-cham-diem-batch
   Body: {
     updates: [
       { NhanVienNhiemVuID: "...", DiemTuDanhGia: 85 },
       { NhanVienNhiemVuID: "...", DiemTuDanhGia: 75 }
     ]
   }

4. Backend ki·ªÉm tra:
   ‚úÖ Chu k·ª≥ ch∆∞a ƒë√≥ng
   ‚úÖ KPI ch∆∞a duy·ªát

5. N·∫øu PASS:
   ‚Üí Batch update NhanVienNhiemVu
   ‚Üí Tr·∫£ v·ªÅ danh s√°ch c·∫≠p nh·∫≠t
   ‚Üí Toast "C·∫≠p nh·∫≠t ƒëi·ªÉm th√†nh c√¥ng!"

6. N·∫øu FAIL:
   ‚Üí Hi·ªÉn th·ªã l·ªói c·ª• th·ªÉ (CYCLE_CLOSED / KPI_APPROVED)
```

---

## üìù Quy Tr√¨nh 3: Qu·∫£n L√Ω Ch·∫•m ƒêi·ªÉm KPI

### B∆∞·ªõc 1: Truy C·∫≠p Trang KPI

**Ng∆∞·ªùi d√πng:** Qu·∫£n l√Ω (Manager)  
**Menu:** `Qu·∫£n l√Ω c√¥ng vi·ªác > KPI`

1. Click menu "KPI"
2. Ch·ªçn nh√¢n vi√™n c·∫ßn ch·∫•m ƒëi·ªÉm
3. H·ªá th·ªëng hi·ªÉn th·ªã danh s√°ch nhi·ªám v·ª• c·ªßa nh√¢n vi√™n

---

### B∆∞·ªõc 2: Ch·∫•m ƒêi·ªÉm Chi Ti·∫øt

**UI:** Form nh·∫≠p ƒëi·ªÉm cho t·ª´ng ti√™u ch√≠

**C√¥ng th·ª©c t√≠nh:**

```javascript
// V·ªõi nhi·ªám v·ª• c√≥ "m·ª©c ƒë·ªô ho√†n th√†nh"
DiemNhiemVu = (DiemQL √ó 2 + DiemTuDanhGia) / 3

// V√≠ d·ª•:
// DiemQL = 90, DiemTuDanhGia = 85
// ‚Üí DiemNhiemVu = (90 √ó 2 + 85) / 3 = 88.33
```

---

### B∆∞·ªõc 3: Duy·ªát KPI

**UI:** N√∫t [Duy·ªát KPI]

**Lu·ªìng:**

```
1. Click n√∫t [Duy·ªát KPI]

2. Backend t√≠nh to√°n:
   - L·∫•y t·∫•t c·∫£ nhi·ªám v·ª• c·ªßa nh√¢n vi√™n
   - T√≠nh DiemNhiemVu cho t·ª´ng nhi·ªám v·ª•
   - T·ªïng h·ª£p TongDiemKPI
   - L∆∞u snapshot v√†o DanhGiaKPI.TongDiemKPI

3. C·∫≠p nh·∫≠t:
   - DanhGiaKPI.TrangThai = "DA_DUYET"
   - DanhGiaKPI.NguoiDuyetID = user._id
   - DanhGiaKPI.NgayDuyet = Date.now()

4. K·∫øt qu·∫£:
   ‚Üí Kh√≥a ch·ªânh s·ª≠a ph√°n c√¥ng
   ‚Üí Kh√≥a t·ª± ƒë√°nh gi√°
   ‚Üí L∆∞u l·ªãch s·ª≠ duy·ªát
```

---

## üîÑ Quy Tr√¨nh 4: Sao Ch√©p Chu K·ª≥

### B∆∞·ªõc 1: Truy C·∫≠p Trang Chi Ti·∫øt

**Ng∆∞·ªùi d√πng:** Qu·∫£n l√Ω  
**Route:** `/giao-nhiem-vu-chu-ky/:employeeId?chuKyId=xxx`

---

### B∆∞·ªõc 2: Click N√∫t Sao Ch√©p

**UI:** N√∫t [Sao ch√©p t·ª´ Q4/2024]

**Lu·ªìng:**

```
1. Click n√∫t [Sao ch√©p t·ª´ Q4/2024]

2. H·ªá th·ªëng hi·ªÉn th·ªã confirm dialog:
   "B·∫°n c√≥ ch·∫Øc mu·ªën sao ch√©p 5 nhi·ªám v·ª• t·ª´ chu k·ª≥ Q4/2024?"

3. Click [ƒê·ªìng √Ω]

4. G·ªçi API:
   POST /nhan-vien/:id/copy-from-previous
   Body: { currentCycleId: "..." }

5. Backend x·ª≠ l√Ω:
   - T√¨m chu k·ª≥ tr∆∞·ªõc (TuNgay < current.TuNgay)
   - L·∫•y t·∫•t c·∫£ NhanVienNhiemVu c·ªßa chu k·ª≥ tr∆∞·ªõc
   - Copy sang chu k·ª≥ m·ªõi:
     + Gi·ªØ nguy√™n NhiemVuID, MucDoKho
     + Reset DiemTuDanhGia = 0
     + Set ChuKyDanhGiaID = currentCycleId

6. K·∫øt qu·∫£:
   ‚Üí Hi·ªÉn th·ªã toast "ƒê√£ sao ch√©p 5 nhi·ªám v·ª•!"
   ‚Üí Redux state c·∫≠p nh·∫≠t
   ‚Üí C·ªôt ph·∫£i hi·ªÉn th·ªã c√°c nhi·ªám v·ª• ƒë√£ copy
```

---

## ‚ö†Ô∏è C√°c T√¨nh Hu·ªëng ƒê·∫∑c Bi·ªát

### T√¨nh Hu·ªëng 1: Chu K·ª≥ ƒê√£ ƒê√≥ng

**Tri·ªáu ch·ª©ng:**

- N√∫t [L∆∞u t·∫•t c·∫£] b·ªã disable
- Slider b·ªã kh√≥a (disabled)
- Th√¥ng b√°o: "Chu k·ª≥ ƒë√£ ƒë√≥ng. Vui l√≤ng li√™n h·ªá Admin ƒë·ªÉ m·ªü l·∫°i."

**Gi·∫£i ph√°p:**

1. Admin truy c·∫≠p trang **ChuKyDanhGia**
2. T√¨m chu k·ª≥ c·∫ßn m·ªü
3. Click [M·ªü l·∫°i]
4. `ChuKyDanhGia.isDong = false`

---

### T√¨nh Hu·ªëng 2: KPI ƒê√£ Duy·ªát

**Tri·ªáu ch·ª©ng:**

- Kh√¥ng th·ªÉ thay ƒë·ªïi ph√¢n c√¥ng
- Kh√¥ng th·ªÉ t·ª± ƒë√°nh gi√°
- Th√¥ng b√°o: "KPI ƒë√£ ƒë∆∞·ª£c duy·ªát. Vui l√≤ng h·ªßy duy·ªát tr∆∞·ªõc."

**Gi·∫£i ph√°p:**

1. Qu·∫£n l√Ω truy c·∫≠p trang **KPI**
2. T√¨m ƒë√°nh gi√° KPI c·ªßa nh√¢n vi√™n
3. Click [H·ªßy duy·ªát]
4. Nh·∫≠p l√Ω do h·ªßy duy·ªát
5. `DanhGiaKPI.TrangThai = "CHUA_DUYET"`
6. L∆∞u l·ªãch s·ª≠ h·ªßy duy·ªát v√†o `LichSuHuyDuyet`

---

### T√¨nh Hu·ªëng 3: Kh√¥ng Th·ªÉ X√≥a Nhi·ªám V·ª•

**Tri·ªáu ch·ª©ng:**

- N√∫t [√ó] kh√¥ng ho·∫°t ƒë·ªông
- Th√¥ng b√°o: "Kh√¥ng th·ªÉ x√≥a. Nh√¢n vi√™n ƒë√£ t·ª± ch·∫•m ƒëi·ªÉm."

**Gi·∫£i ph√°p:**

1. Nh√¢n vi√™n truy c·∫≠p trang **T·ª± ƒë√°nh gi√° KPI**
2. T√¨m nhi·ªám v·ª• c·∫ßn x√≥a
3. K√©o slider ƒëi·ªÉm v·ªÅ 0%
4. Click [L∆∞u t·∫•t c·∫£]
5. Qu·∫£n l√Ω quay l·∫°i trang ph√¢n c√¥ng
6. C√≥ th·ªÉ x√≥a nhi·ªám v·ª•

---

## üéâ K·∫øt Lu·∫≠n

T√†i li·ªáu n√†y m√¥ t·∫£ **4 quy tr√¨nh ch√≠nh** c·ªßa module GiaoNhiemVu:

‚úÖ **Quy tr√¨nh 1:** Qu·∫£n l√Ω g√°n nhi·ªám v·ª• (8 b∆∞·ªõc)  
‚úÖ **Quy tr√¨nh 2:** Nh√¢n vi√™n t·ª± ƒë√°nh gi√° (5 b∆∞·ªõc)  
‚úÖ **Quy tr√¨nh 3:** Qu·∫£n l√Ω ch·∫•m ƒëi·ªÉm KPI (3 b∆∞·ªõc)  
‚úÖ **Quy tr√¨nh 4:** Sao ch√©p chu k·ª≥ (2 b∆∞·ªõc)  
‚úÖ **C√°c t√¨nh hu·ªëng ƒë·∫∑c bi·ªát:** 3 t√¨nh hu·ªëng v·ªõi gi·∫£i ph√°p

---

**C·∫≠p nh·∫≠t cu·ªëi:** 26/11/2025  
**T√°c gi·∫£:** GitHub Copilot (Claude Sonnet 4.5)  
**Phi√™n b·∫£n t√†i li·ªáu:** 1.0.0
